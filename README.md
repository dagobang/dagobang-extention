# Dagobang Extension

Dagobang 是一款专为极速交易设计的浏览器插件，基于最新的 WXT 框架构建。它支持在页面内直接进行代币买卖，无需依赖外部钱包弹窗，通过静默签名和 RPC 竞速技术实现毫秒级上链。

## 核心特性

### 🚀 极速交易
- **静默签名 (Silent Signing)**: 解锁钱包后，交易直接在后台完成签名并广播，无需二次弹窗确认，真正实现“一键买入”。
- **RPC 竞速 (RPC Race)**: 同时向多个 RPC 节点广播交易，以最快被确认的节点为准，显著提高上链速度。
- **Gas 加速预设**: 内置 Slow/Standard/Fast (1.25x) 档位，应对网络拥堵。

### 🛡️ 安全与隐私
- **非托管密钥**: 私钥使用 AES-GCM 高强度加密存储在本地 (`storage.local`)，绝不上传服务器。
- **内存级解锁**: 解锁后的私钥仅存在于内存 (`storage.session`)，浏览器关闭或超时自动销毁。
- **Anti-MEV**: 支持配置专用隐私 RPC (如 Flashbots, MevBlocker) 防止夹子攻击。
- **自动锁定**: 支持自定义超时自动锁定时间，保护资金安全。

### 🧩 模块化架构
- **Service Pattern**: 采用 Service 层设计 (Wallet, Trade, RPC, Settings)，逻辑清晰，易于扩展。
- **Shadow DOM UI**: 页面注入组件使用 Shadow DOM 隔离样式，不污染目标网页。
- **TypeScript**: 全链路类型安全。

## 目录结构

```
dagobang-extention/
├── entrypoints/
│   ├── background.ts      # 后台服务入口 (消息分发)
│   ├── content.ts         # 页面脚本 (注入悬浮窗)
│   ├── popup/             # 插件弹窗 (React + Tailwind)
│   └── content-ui/        # 悬浮窗 UI 组件
├── src/
│   ├── services/          # 核心业务逻辑
│   │   ├── wallet.ts      # 密钥管理与加解密
│   │   ├── trade.ts       # 交易构建与广播
│   │   ├── rpc.ts         # RPC 连接池与竞速
│   │   └── storage.ts     # 持久化存储适配
│   └── shared/            # 共享类型与工具
└── wxt.config.ts          # WXT 配置文件
```

## 开发与构建

### 环境要求
- Node.js >= 18
- NPM / Yarn

### 安装依赖
```bash
npm install
```

### 开发模式 (HMR)
```bash
npm run dev
```

### 生产构建
```bash
npm run build
```
构建产物将输出到 `.output/` 目录，可直接加载到 Chrome/Edge 浏览器中。

## 安全性说明

1. **存储加密**: 用户的助记词/私钥在落盘前经过 `PBKDF2` 派生密钥和 `AES-GCM` 加密。
2. **零后端**: 插件直接与区块链节点交互，不经过任何中间后端服务，杜绝单点故障与数据泄露。
3. **权限控制**: 仅申请必要的 `storage` 和 `activeTab` 权限。

### 和 MetaMask 的安全模型对比

- **本地非托管这一点是一样的**  
  - MetaMask 和 Dagobang 都是把助记词/私钥加密后存到浏览器本地，不上传到任何服务器。  
  - 两者都用“你设置的钱包密码”派生出对称密钥，再用 AES 之类算法加密钱包数据。

- **解锁后，私钥都会在内存里出现**  
  - 不管是 MetaMask 还是 Dagobang，只要你输入密码解锁，浏览器进程里就会出现明文私钥，用来给交易签名。  
  - 如果此时电脑已经中毒（有键盘记录器、恶意扩展、系统木马等），理论上攻击者都可以拿到你的钱包密码和私钥——这一点任何本地热钱包都做不到完全防御。

- **主要差异在“交互体验”，而不是“密码学强度”**  
  - MetaMask：多数情况下每笔交易都会弹出确认窗口，你可以看到具体要签什么。  
  - Dagobang：为了极限速度，解锁后在约定的场景下走“静默签名”，不再每笔弹窗确认，更适合高频、快进快出的交易玩家。  
  - 这意味着：在代码没被篡改的前提下，两者的加密和存储强度都足够安全；一旦电脑或浏览器环境被攻破，谁都保护不了已经解锁的钱包，只是 MetaMask 更容易让你“看见有异常交易”，Dagobang 则把确认这一步交给了你自己在解锁前做判断。

- **什么时候适合用 Dagobang，什么时候用 MetaMask？**  
  - 日常大额长期持仓：建议使用硬件钱包或冷钱包，MetaMask/Dagobang 这类热钱包只保存少量流动资金。  
  - 高频抢跑、秒买秒卖：更适合用 Dagobang（解锁时间短、交互更快）。  
  - 对安全极度敏感的用户：无论用哪种钱包，都建议在干净的专用电脑/浏览器里使用，不要在装了很多破解软件和未知扩展的环境里操作大额资金。

简单记住一句话：  
> Dagobang 在“本地加密存储”和“非托管”这点上和 MetaMask 同级别安全，但在“电脑已经中毒”的情况下，任何热钱包都保护不了你的资产，真正的边界是你的机器和使用习惯。

## 常见问题

**Q: 为什么不需要弹窗确认？**
A: 当您在插件 Popup 界面输入密码解锁钱包后，解密后的私钥会临时驻留在内存中。此时点击页面上的交易按钮，后台服务会直接调用内存中的私钥进行签名。这通过牺牲一步确认换取了极致的交易速度。您可以随时点击 "Lock" 按钮清除内存中的私钥。

**Q: 如何配置 RPC？**
A: 在插件设置页输入 RPC URL 列表（每行一个）。建议混合使用公共节点和付费节点以获得最佳竞速效果。
